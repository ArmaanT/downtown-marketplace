{% extends 'main/base.html' %}

{% block header %}
<div class="columns is-desktop">
  <div class="column is-6 is-offset-3 has-text-centered">
    <h1 class="title is-1">{{ profile_user.first_name }} {{ profile_user.last_name}}</h1>
    <h1 class="subtitle">@{{ profile_user.username }}</h1>
    {% if follow_state == 1 %}
    <a class="button is-primary"><p><i class="fas fa-check"></i> following</p></a>
    {% elif follow_state == 2 %}
    <button class="button is-info" onclick="follow()"><p><i class="fas fa-plus"></i> follow</p></button>
    <script type="text/javascript">
      function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }
      function follow() {
        console.log("a")
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/accounts/follow/", true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        urlEncodedDataPairs = []
        urlEncodedDataPairs.push(encodeURIComponent("username") + '=' + encodeURIComponent("{{ profile_user.username }}"));
        urlEncodedDataPairs.push(encodeURIComponent("csrfmiddlewaretoken") + '=' + encodeURIComponent(getCookie('csrftoken')));
        urlEncodedData = urlEncodedDataPairs.join('&').replace(/%20/g, '+');
        xhr.send(urlEncodedData);
        location.reload();
      }
    </script>
    {% else %}
    <a class="button is-info" disabled><p>Log in to follow</p></a>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block content %}
{% for ticket in profile_user.ticket_set.all %}
<div class="columns">
  <div class="column is-6 is-offset-3">
    <div class="box">
      <div class="columns">
        <div class="column">
          <strong class="is-size-3">
            {{ ticket.downtown }}
          </strong>
        </div>
        <div class="column has-text-right">
          <strong class="is-size-3">
            ${{ ticket.price }}
          </strong>
        </div>
      </div>
    </div>
  </div>
</div>
{% endfor %}
{% endblock %}
